<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>üí¨ –ü—Ä–æ—Å—Ç–æ–π –†–∞–±–æ—á–∏–π –ß–∞—Ç</title>
    <style>
        body { font-family: Arial; background: #667eea; padding: 20px; margin: 0; }
        .chat { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        h2 { text-align: center; color: #333; margin-bottom: 20px; }
        .messages { height: 400px; border: 2px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px; overflow-y: auto; background: #f9f9f9; }
        .message { margin-bottom: 12px; padding: 10px; background: white; border-radius: 8px; border-left: 4px solid #667eea; }
        .message-header { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px; }
        .username { font-weight: bold; color: #667eea; }
        .time { color: #888; }
        .input-group { display: flex; gap: 10px; margin-bottom: 10px; }
        input { flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px; }
        button { padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
        button:hover { background: #5a6fd8; }
        .info { background: #d4edda; color: #155724; padding: 12px; border-radius: 6px; margin-bottom: 15px; text-align: center; }
    </style>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>
<body>
    <div class="chat">
        <h2>üí¨ –ü—Ä–æ—Å—Ç–æ–π –û–±—â–∏–π –ß–∞—Ç</h2>
        <div class="info" id="status">
            üîÑ –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è...
        </div>
        
        <div class="input-group">
            <input type="text" id="nameInput" placeholder="–í–∞—à–µ –∏–º—è" maxlength="20">
            <input type="text" id="messageInput" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" maxlength="500">
        </div>
        <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
        
        <div class="messages" id="messagesContainer">
            <div style="text-align: center; color: #666; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</div>
        </div>
    </div>

    <script>
        // Firebase configuration - –ë–ï–ó–û–ü–ê–°–ù–û, –º–æ–∂–Ω–æ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
        const firebaseConfig = {
            apiKey: "AIzaSyCZNAjHdN4wjUtivXp6W-6dHnCg1VcJ8eU",
            authDomain: "public-chat-demo-12345.firebaseapp.com",
            databaseURL: "https://public-chat-demo-12345-default-rtdb.firebaseio.com",
            projectId: "public-chat-demo-12345",
            storageBucket: "public-chat-demo-12345.firebasestorage.app",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let isConnected = false;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        database.ref('.info/connected').on('value', (snapshot) => {
            isConnected = snapshot.val() === true;
            document.getElementById('status').textContent = isConnected 
                ? '‚úÖ –û–ë–©–ò–ô –ß–ê–¢ –†–ê–ë–û–¢–ê–ï–¢! –°–æ–æ–±—â–µ–Ω–∏—è –≤–∏–¥–Ω—ã –≤—Å–µ–º!' 
                : '‚ö†Ô∏è –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
        });

        function sendMessage() {
            const name = document.getElementById('nameInput').value.trim();
            const text = document.getElementById('messageInput').value.trim();
            
            if (!name || !text) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ!');
                return;
            }

            if (!isConnected) {
                alert('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Firebase
            database.ref('messages').push().set({
                username: name,
                text: text,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                time: new Date().toLocaleTimeString('ru-RU'),
                date: new Date().toLocaleDateString('ru-RU')
            });

            document.getElementById('messageInput').value = '';
        }

        // –°–ª—É—à–∞–µ–º –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        database.ref('messages').limitToLast(50).on('child_added', (snapshot) => {
            const message = snapshot.val();
            addMessageToChat(message);
        });

        function addMessageToChat(message) {
            const container = document.getElementById('messagesContainer');
            
            // –£–±–∏—Ä–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
            if (container.querySelector('div') && container.querySelector('div').textContent.includes('–ó–∞–≥—Ä—É–∑–∫–∞')) {
                container.innerHTML = '';
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.innerHTML = `
                <div class="message-header">
                    <span class="username">${message.username}</span>
                    <span class="time">${message.time} ${message.date}</span>
                </div>
                <div>${message.text}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ Enter
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        database.ref('messages').limitToLast(50).once('value', (snapshot) => {
            const messages = snapshot.val();
            if (messages) {
                Object.values(messages).forEach(message => {
                    addMessageToChat(message);
                });
            }
        });
    </script>
</body>
</html>
